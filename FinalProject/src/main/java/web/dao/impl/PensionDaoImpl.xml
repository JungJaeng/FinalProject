<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스3 Mapper DOCTYPE -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="web.dao.face.PensionDao">
	
	<select id="selectCntAll" parameterType="map" resultType="int">
		SELECT COUNT(*) FROM pension
		<where>
			<if test="name!=null and search!=null">
				<choose>
					<when test="name.equals('pension_name')">
						pension_name LIKE '%'||#{search}||'%'
					</when>
				</choose>
			</if>
		</where>
	</select>
	
	<select id="selectAll" parameterType="web.util.Paging" resultType="web.dto.Pension">
		SELECT * FROM (
			SELECT rownum rnum, B.* FROM (
				SELECT
				pension_no, pension_name, pension_postcode, pension_address, pension_detailAddress, pension_content FROM pension
				<where>
					<if test="name!=null and search!=null">
						<choose>
						<when test="name.equals('pesion_name')">
							pension_name LIKE '%'||#{search}||'%'
						</when>
						<when test="name.equals('pension_location')">
							pension_location LIKE '%'||#{search}||'%'
						</when>
						
						</choose>
					</if>
				</where>
				ORDER BY pension_no ASC 
				) B
			ORDER BY rnum
		)WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
<!-- 	<select id="selectComment" parameterType="web.dto.Pension" -->
<!-- 		resultType="web.dto.Comment"> -->
<!-- 		SELECT rownum rnum, B.* FROM ( -->
<!-- 			SELECT -->
<!-- 				commentno, -->
<!-- 				pensionno, -->
<!-- 				user_id, -->
<!-- 				writer_nick, -->
<!-- 				content, -->
<!-- 				writtendate -->
<!-- 			FROM commentTb -->
<!-- 			WHERE boardno = #{board_no } -->
<!-- 		) B -->
<!-- 		ORDER BY rnum -->
<!-- 	</select> -->
	
<!-- 	<insert id="insertComment" parameterType="web.dto.Comment"> -->
<!-- 		INSERT INTO commentTB ( commentno,boardno,userid,commentWriter,content ) -->
<!-- 		VALUES ( commentTb_seq.nextval, #{boardNo }, #{userid }, #{commentWriter }, #{content } ) -->
<!-- 	</insert> -->

<!-- 	<delete id="deleteComment" parameterType="web.dto.Comment"> -->
<!-- 		DELETE commentTb WHERE -->
<!-- 		commentno = #{commentNo } -->
<!-- 	</delete> -->

<!-- 	<select id="countComment" parameterType="web.dto.Comment" -->
<!-- 		resultType="int"> -->
<!-- 		SELECT COUNT(*) FROM commenttb WHERE commentno=#{commentNo} -->
<!-- 	</select>	 -->
	
	<insert id="write" parameterType="web.dto.PensionRegisterApply">
		INSERT INTO PensionRegisterApply(apply_no, writer, pension_name, pension_postcode, pension_address, pension_detailAddress, pension_content, room_name, room_content, room_men, room_size, room_price)
		VALUES(
			PensionRegisterApply_seq.nextval,
			#{writer},
			#{pension_name},
			#{pension_postcode}, 
			#{pension_address},
			#{pension_detailAddress},
			#{pension_content},
			#{room_name},
			#{room_content},
			#{room_men},
			#{room_size},
			#{room_price}
			)
	</insert>	

	<select id="getApply_no" resultType="int">
		SELECT PensionRegisterApply_seq.nextval FROM dual
	</select>
	
	<insert id="insertImage" parameterType="web.dto.Upload_Image">
		<selectKey resultType="int" keyProperty="fileno" order="BEFORE" >
			SELECT pension_image_seq.nextval FROM dual
		</selectKey>
		INSERT INTO pension_image(fileno,apply_no,origin_name,stored_name,filesize)
		VALUES (#{fileno},#{board_no},#{origin_name},#{stored_name},#{filesize})
	</insert>
	
	<select id="selectImgByfileno" parameterType="web.dto.Upload_Image" resultType="web.dto.Upload_Image">
		SELECT * FROM pension_image WHERE fileno = #{fileno }
	</select>

</mapper>